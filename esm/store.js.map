{"version":3,"sources":["../src/store.js"],"names":["ReactVueLikeStore","module","parent","root","namespace","mutationListeners","namespaced","getters","prefix","state","mutations","Object","keys","forEach","key","get","modules","observable","object","_state","v","_getters","fn","callback","oldValue","event","payload","mutation","ret","call","type","handler","includes","push","idx","indexOf","splice","ReactVueLike","$store","prototype"],"mappings":"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","sourcesContent":["import { observable, action, when, set } from 'mobx';\nimport { defComputed } from './utils';\n\nclass ReactVueLikeStore {\n  constructor(module = {}, parent, root, namespace) {\n    this.root = root || this;\n    this.parent = parent;\n    this.mutationListeners = [];\n    this.namespace = namespace || '';\n    this.namespaced = module.namespaced || false;\n\n    const getters = {};\n    const prefix = this.prefix;\n\n    const state = module.state || {};\n    const mutations = module.mutations || {};\n    if (module.getters) {\n      Object.keys(module.getters).forEach(key => defComputed(getters, key, () => {\n        let get = module.getters[key];\n        return get(this.state, this.getters, this.root.state, this.root.getters);\n      }));\n    }\n\n    const modules = module.modules || {};\n    Object.keys(mutations).forEach(key => mutations[key] = action(mutations[key]));\n    Object.keys(modules).forEach(key => {\n      modules[key] = new ReactVueLikeStore(modules[key], this, this.root, `${prefix}${key}`);\n    });\n\n    this.state =  observable.object(state);\n    this.getters = observable.object(getters);\n    this.mutations = mutations;\n    this.modules = modules;\n\n    if (this.root !== this) {\n      const _state = {};\n      Object.keys(this.state).forEach(key => {\n        defComputed(_state, `${prefix}${key}`, () => this.state[key], v => this.state[key] = v);\n      });\n      set(this.root.state, _state);\n\n      const _getters = {};\n      Object.keys(this.getters).forEach(key => {\n        defComputed(_getters, `${prefix}${key}`, () => this.getters[key]);\n      });\n      set(this.root.getters, _getters);\n    }\n  }\n\n  get prefix() {\n    return this.namespaced ? (this.namespace ? this.namespace + '/' : '') : '';\n  }\n\n  watch(fn, callback) {\n    let oldValue;\n    return when(() => oldValue !== fn(), callback);\n  }\n\n  commit(event, payload) {\n    if (!event) return;\n\n    const mutation = this.mutations[event];\n    if (!mutation) return;\n\n    let ret = mutation.call(this, this.state, payload, this.parent, this.root);\n    this.mutationListeners.forEach(v => v({ type: 'UPDATE_DATA', payload }, this.state));\n    return ret;\n  }\n\n  subscribe(handler) {\n    if (!handler || this.mutationListeners.includes(handler)) return;\n    this.mutationListeners.push(handler);\n    return () => {\n      const idx = this.mutationListeners.indexOf(handler);\n      if (~idx) this.mutationListeners.splice(idx, 1);\n    };\n  }\n\n  install(ReactVueLike) {\n    ReactVueLike.$store = ReactVueLike.prototype.$store = this;\n  }\n}\n\nexport default ReactVueLikeStore;\n"],"file":"store.js"}